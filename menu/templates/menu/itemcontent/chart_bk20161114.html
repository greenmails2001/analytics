<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<div class="col-sm-6 col-xs-12">
      <div class="panel panel-default text-center">
        <div class="panel-heading">
          <h1>{{item}}</h1>

        </div>
        <div class="panel-body">
            <div ng-app="myApp" ng-controller="namesCtrl">

            <p>Type a letter in the input field:</p>
{% verbatim %}
            <p><input type="text" ng-model="test"></p>
            <ul>
              <li ng-repeat="x in names | filter:test">
                <a>{{ x.name }}</a>
              </li>
            </ul>

            <select  ng-model="selectedSite" onchange="abc()">
                <option ng-repeat="x in names">
                    {{ x.id }}
                </option>

            </select>
            <a>Site: {{ selectedSite }}</a>

            {% endverbatim %}
            Index:
            <select class="action" id={{index}}>
                <option value=''>-----</option>
                <option value="{{ value.build_id }}">Build Details</option>
            </select>
            Foo:
        <select id="foo">
            <option value="">---</option>
            {% for value in sites %}
              <option value="{{ value.siteid }}">{{ value.sitename }}</option>
            {% endfor %}
        </select>
        Foo2:
        <select id="foo2" onChange="reloadImage(this);">
            <option value="">---</option>
            {% for value in sites %}
              <option value="{{ value.siteid }}">{{ value.sitename }}</option>
            {% endfor %}
        </select>
        <img id="sourceimage" src="#" alt="your image" />
            </div>
            <p><strong>{{ item.content|linebreaks|safe }}</strong></p>
            [{% for site in sites %}
                {% if not forloop.first %},{% endif %}
                '{{site.sitename}}'
            {% endfor %}]
        </div>
        <div class="panel-footer">
          <button class="btn btn-lg">Detail</button>

            <input type='file' id="upload" onchange="reloadImage(this);" />
            <img id="img" src="#" alt="your image" />

            <input type='file' id="upload" onChange="readURL(this);"/>
            <img id="img" src="#" alt="your image" />
        </div>
      </div>

</div>

<script type="text/javascript">

angular.module('myApp', []).controller('namesCtrl', function($scope) {
    var array_sites=[{% for site in sites %}
                {% if not forloop.first %},{% endif %}
                    {id:'{{site.siteid}}', name:'{{site.sitename}}'}
            {% endfor %}];
    $scope.names = array_sites;
});
    var varid=123;
    var varurl='{% url "plotResults" 123 %}';

    urlMap = {
    {% for value in sites %}
        '{{ value.siteid }}' : varurl.replace(/123/, {{value.siteid}}) {% if not forloop.last %},{% endif %}
    {% endfor %}
    };

    $(function() {
         $("#foo").change(function() {
             alert($(this).val());
             $('#sourceimage').attr('src', urlMap[$(this).val()]);
            //location.href = urlMap[$(this).val()];
        });
    });

    $(function() {
            var item_len = parseInt({{dict_len}});
            for (var i = 0; i < item_len; i++){
                $("#"+i.toString()+".action").change(function() {
                      if($(this).val() != '')
                         window.location.href = urlMap[$(this).val()];
                }
            )
        }});

function readURL(input){
 var ext = input.files[0]['name'].substring(input.files[0]['name'].lastIndexOf('.') + 1).toLowerCase();
    if (input.files && input.files[0] && (ext == "gif" || ext == "png" || ext == "jpeg" || ext == "jpg"))
    {
        var reader = new FileReader();
        reader.onload = function (e) {
            $('#img').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
    else{
         $('#img').attr('src', '/assets/no_preview.png');
    }
}

function reloadImage(selectObj){
 // get the index of the selected option
 var idx = selectObj.selectedIndex;
 // get the value of the selected option
 var which = selectObj.options[idx].value;
 var urlparam='{% url "plotResults" %}';
 var urlparam2='/images/excel.png';
    alert(urlparam);
    $('#sourceimage').attr('src', urlparam2);
}
</script>